<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Tambah Barang</title>
<style>
* {
  box-sizing: border-box;
}
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: Arial, sans-serif;
  background-color: #e6f0ff;
  color: #003366;
}
body {
  max-width: 360px;
  margin: 0 auto;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
#wrapper {
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  display: flex;
  flex-direction: column;
  padding: 0 15px 15px;
}
header {
  background: linear-gradient(90deg, #1a75ff, #0047b3);
  color: white;
  padding: 12px 15px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
  border-radius: 6px 6px 0 0;
  margin-bottom: 10px;
}
header h1 {
  margin: 0;
  font-size: 1.25rem;
  flex-grow: 1;
  text-align: center;
  font-weight: bold;
  letter-spacing: 1px;
}
#menuButton {
  background: none;
  border: none;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0 10px 0 0;
  user-select: none;
  flex-shrink: 0;
  line-height: 1;
}
main {
  flex-grow: 1;
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
h2, h3 {
  margin: 5px 0;
  font-weight: 700;
  color: #003366;
  text-align: center;
}
p {
  text-align: center;
  color: #004080;
  font-size: 0.95rem;
  margin: 0 0 8px 0;
  padding: 0 5px;
}
#inputSection {
  background-color: white;
  border-radius: 8px;
  padding: 14px 18px;
  box-shadow: 0 3px 8px rgb(0 55 153 / 0.15);
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.inputGroup {
  position: relative;
}
.label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: 1rem;
  color: #0047b3;
}
.inputValue {
  border: 2px solid #a3c0ff;
  outline: none;
  border-radius: 8px;
  padding: 10px;
  font-size: 1.1rem;
  color: #0059b3;
  background-color: #eaf2ff;
  user-select: none;
  letter-spacing: 1px;
  min-height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.clearBtn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background-color: #cc3300;
  border: none;
  border-radius: 50%;
  color: white;
  width: 26px;
  height: 26px;
  font-size: 18px;
  line-height: 1;
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  transition: background-color 0.3s ease;
}
.clearBtn:hover {
  background-color: #992200;
}
.controlsRow {
  display: flex;
  gap: 10px;
  margin-top: 4px;
  flex-wrap: wrap;
}
button#startRecording, button#addItem {
  flex: 1 1 48%;
  padding: 12px;
  font-size: 1.1rem;
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  min-width: 140px;
}
button#startRecording {
  background: linear-gradient(90deg, #3366ff, #003399);
}
button#startRecording:hover:not(:disabled) {
  background: linear-gradient(90deg, #003399, #3366ff);
}
button#startRecording:disabled {
  background-color: #a3bfff;
  cursor: not-allowed;
}
button#addItem {
  background: linear-gradient(90deg, #007acc, #005fa3);
}
button#addItem:hover:not(:disabled) {
  background: linear-gradient(90deg, #005fa3, #007acc);
}
button#addItem:disabled {
  background-color: #9cc5e8;
  cursor: not-allowed;
}
ul#itemList {
  list-style: none;
  padding: 0;
  margin: 0;
  border-radius: 8px;
  background-color: white;
  box-shadow: 0 3px 8px rgb(0 0 128 / 0.2);
  display: flex;
  flex-direction: column;
  scroll-padding: 10px;
}
li.item {
  background-color: #f0f5ff;
  border-radius: 6px;
  border: 1.5px solid #a3c0ff;
  margin: 8px 10px;
  padding: 14px 20px 12px 20px;
  box-shadow: 0 1px 3px rgb(0 50 150 / 0.15);
  color: #003366;
  font-weight: 600;
  letter-spacing: 0.4px;
  font-size: 1rem;
  display: flex;
  flex-direction: column;
}
.itemDetails {
  display: grid;
  grid-template-columns: auto auto;
  gap: 6px 10px;
}
.itemDetails > div.labelItem {
  color: #003399;
  font-weight: 700;
  font-size: 0.9rem;
}
.itemDetails .price {
  font-weight: 700;
  color: #0047b3;
  font-size: 1.1rem;
  grid-column: 1 / span 2;
}
.actionsRow {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 8px;
}
button.adjustBtn {
  background-color: #28a745;
  border: none;
  border-radius: 5px;
  color: white;
  padding: 8px 16px;
  font-size: 0.95rem;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  min-width: 50px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}
button.adjustBtn:hover {
  background-color: #1e7e34;
}
button.deleteBtn {
  background-color: #cc3300;
  border: none;
  border-radius: 5px;
  color: white;
  padding: 8px 16px;
  font-size: 0.95rem;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  height: 36px;
  min-width: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}
button.deleteBtn:hover {
  background-color: #992200;
}
@media (max-width: 400px) {
  body {
    max-width: 100%;
    height: 100vh;
  }
  #wrapper {
    padding: 0 10px 10px 10px;
  }
  main {
    gap: 10px;
  }
  .controlsRow {
    flex-direction: column;
  }
  button#startRecording, button#addItem {
    flex: 1 1 100%;
  }
  li.item {
    padding: 14px 12px 12px 12px;
  }
  .actionsRow {
    justify-content: flex-start;
    flex-wrap: wrap;
    gap: 6px;
  }
  button.adjustBtn, button.deleteBtn {
    padding: 8px 14px;
    font-size: 1rem;
    min-width: 40px;
    height: 36px;
  }
}
</style>
</head>
<body>
<div id="wrapper">
<header>
  <button id="menuButton" title="Menu">â˜°</button>
  <h1>Tambah Barang</h1>
  <div style="width:30px;"></div>
</header>

<main>
  <h2>Catat Produk Terbaru</h2>
  <p id="guideText" aria-live="polite" aria-atomic="true">Silakan mulai dengan mengucapkan <strong>"Nama Barang"</strong></p>

  <section id="inputSection" aria-live="polite" aria-atomic="true">
    <div class="inputGroup">
      <label class="label" for="itemName">Nama Barang</label>
      <div id="itemName" class="inputValue" aria-live="polite" aria-atomic="true" tabindex="0"></div>
      <button class="clearBtn" aria-label="Hapus nama barang" data-clear="0" title="Hapus nama barang">&times;</button>
    </div>
    <div class="inputGroup">
      <label class="label" for="itemQuantity">Jumlah</label>
      <div id="itemQuantity" class="inputValue" aria-live="polite" aria-atomic="true" tabindex="0"></div>
      <button class="clearBtn" aria-label="Hapus jumlah" data-clear="1" title="Hapus jumlah">&times;</button>
    </div>
    <div class="inputGroup">
      <label class="label" for="itemCost">Harga Modal (Rp)</label>
      <div id="itemCost" class="inputValue" aria-live="polite" aria-atomic="true" tabindex="0"></div>
      <button class="clearBtn" aria-label="Hapus harga modal" data-clear="2" title="Hapus harga modal">&times;</button>
    </div>
    <div class="inputGroup">
      <label class="label" for="itemPrice">Harga Jual (Rp)</label>
      <div id="itemPrice" class="inputValue" aria-live="polite" aria-atomic="true" tabindex="0"></div>
      <button class="clearBtn" aria-label="Hapus harga jual" data-clear="3" title="Hapus harga jual">&times;</button>
    </div>
    <div class="controlsRow">
      <button id="startRecording" title="Mulai rekam suara">ðŸŽ¤ Mulai Catat</button>
      <button id="addItem" title="Tambahkan data ke daftar" disabled>âž• Tambahkan</button>
    </div>
  </section>

  <h3>Daftar Barang</h3>
  <ul id="itemList" aria-live="polite" aria-relevant="additions removals"></ul>
</main>
</div>

<script>
(() => {
  const menuButton = document.getElementById('menuButton');
  const startRecordingButton = document.getElementById('startRecording');
  const addItemButton = document.getElementById('addItem');
  const clearButtons = document.querySelectorAll('.clearBtn');
  const inputName = document.getElementById('itemName');
  const inputQuantity = document.getElementById('itemQuantity');
  const inputCost = document.getElementById('itemCost');
  const inputPrice = document.getElementById('itemPrice');
  const guideText = document.getElementById('guideText');
  const itemList = document.getElementById('itemList');

  let items = JSON.parse(localStorage.getItem('items')) || [];
  let currentStep = 0;
  let tempInputs = ["", "", "", ""];

  menuButton.addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  function parseLocaleNumber(stringNumber) {
    if (typeof stringNumber !== 'string') return NaN;
    return Number(stringNumber.replace(/\./g, '').replace(/,/g, '.'));
  }

  function renderItems() {
    itemList.innerHTML = '';
    if (items.length === 0) {
      const emptyMsg = document.createElement('li');
      emptyMsg.textContent = 'Belum ada barang yang dicatat.';
      emptyMsg.style.color = '#666';
      emptyMsg.style.textAlign = 'center';
      emptyMsg.style.padding = '10px';
      itemList.appendChild(emptyMsg);
      return;
    }
    items.forEach((item, index) => {
      const li = document.createElement('li');
      li.className = 'item';
      li.setAttribute('tabindex', '0');

      const detailsDiv = document.createElement('div');
      detailsDiv.className = 'itemDetails';
      detailsDiv.innerHTML = `
        <div class="labelItem">Nama:</div><div>${escapeHtml(item.name)}</div>
        <div class="labelItem">Jumlah:</div><div>${escapeHtml(item.quantity)}</div>
        <div class="labelItem">Harga Modal:</div><div>Rp ${formatNumber(item.cost)}</div>
        <div class="labelItem price">Harga Jual:</div><div>Rp ${formatNumber(item.price)}</div>
      `;
      li.appendChild(detailsDiv);

      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'actionsRow';

      const btnAddQty = document.createElement('button');
      btnAddQty.className = 'adjustBtn';
      btnAddQty.title = 'Tambah Jumlah';
      btnAddQty.textContent = '+';
      btnAddQty.setAttribute('aria-label', 'Tambah jumlah barang ' + item.name);
      btnAddQty.addEventListener('click', () => {
        let qty = parseInt(item.quantity);
        if(isNaN(qty)) qty = 0;
        qty++;
        item.quantity = qty.toString();
        localStorage.setItem('items', JSON.stringify(items));
        renderItems();
      });
      actionsDiv.appendChild(btnAddQty);

      const btnSubtractQty = document.createElement('button');
      btnSubtractQty.className = 'adjustBtn';
      btnSubtractQty.title = 'Kurangi Jumlah';
      btnSubtractQty.textContent = 'âˆ’';
      btnSubtractQty.setAttribute('aria-label', 'Kurangi jumlah barang ' + item.name);
      btnSubtractQty.addEventListener('click', () => {
        let qty = parseInt(item.quantity);
        if(isNaN(qty)) qty = 0;
        if(qty > 1) {
          qty--;
          item.quantity = qty.toString();
          localStorage.setItem('items', JSON.stringify(items));
          renderItems();
        } else if(confirm(`Jumlah barang sudah 1.\nApakah Anda ingin menghapus barang ini dari daftar?`)) {
          items.splice(index, 1);
          localStorage.setItem('items', JSON.stringify(items));
          renderItems();
        }
      });
      actionsDiv.appendChild(btnSubtractQty);

      const delBtn = document.createElement('button');
      delBtn.className = 'deleteBtn';
      delBtn.textContent = 'Hapus';
      delBtn.setAttribute('aria-label', 'Hapus item ' + item.name);
      delBtn.addEventListener('click', () => {
        if(confirm(`Hapus barang "${item.name}" dari daftar?`)) {
          items.splice(index, 1);
          localStorage.setItem('items', JSON.stringify(items));
          renderItems();
        }
      });
      actionsDiv.appendChild(delBtn);

      li.appendChild(actionsDiv);
      itemList.appendChild(li);
    });
  }

  function escapeHtml(text) {
    if(!text) return "";
    return text.replace(/[&<>"']/g, m => ({
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    })[m]);
  }

  function formatNumber(number) {
    let num = number;
    if(typeof number === 'string') {
      num = parseLocaleNumber(number);
    }
    return Number.isNaN(num) ? number : num.toLocaleString('id-ID');
  }

  function updateInputField(step, value) {
    switch(step) {
      case 0: inputName.textContent = value; break;
      case 1: inputQuantity.textContent = value; break;
      case 2: inputCost.textContent = value; break;
      case 3: inputPrice.textContent = value; break;
    }
  }

  function clearInputField(step) {
    switch(step) {
      case 0: inputName.textContent = ""; tempInputs[0] = ""; break;
      case 1: inputQuantity.textContent = ""; tempInputs[1] = ""; break;
      case 2: inputCost.textContent = ""; tempInputs[2] = ""; break;
      case 3: inputPrice.textContent = ""; tempInputs[3] = ""; break;
    }
    addItemButton.disabled = true;
    currentStep = step;
    updateGuideText(currentStep);
  }

  function updateAddButtonState() {
    addItemButton.disabled = !tempInputs.every(val => val !== "");
  }

  function clearAllInputs() {
    inputName.textContent = "";
    inputQuantity.textContent = "";
    inputCost.textContent = "";
    inputPrice.textContent = "";
    tempInputs = ["", "", "", ""];
    currentStep = 0;
    addItemButton.disabled = true;
  }

  function updateGuideText(step) {
    const prompts = [
      'Silakan mulai dengan mengucapkan <strong>"Nama Barang"</strong>',
      'Silakan lanjutkan ucapkan <strong>"Jumlah"</strong> (angka)',
      'Selanjutnya ucapkan <strong>"Harga Modal"</strong> (angka, tanpa Rp)',
      'Terakhir ucapkan <strong>"Harga Jual"</strong> (angka, tanpa Rp)'
    ];
    guideText.innerHTML = prompts[step];
  }

  function startRecognition() {
    if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
      alert('Browser Anda tidak mendukung fitur pengenalan suara.');
      return;
    }
    startRecordingButton.disabled = true;
    startRecordingButton.textContent = 'Mendengarkan...ðŸŽ™ï¸';

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'id-ID';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript.trim();
      switch(currentStep) {
        case 0:
          tempInputs[0] = transcript;
          updateInputField(0, transcript);
          currentStep++;
          break;
        case 1:
          tempInputs[1] = transcript;
          updateInputField(1, transcript);
          currentStep++;
          break;
        case 2:
          tempInputs[2] = transcript;
          updateInputField(2, transcript);
          currentStep++;
          break;
        case 3:
          tempInputs[3] = transcript;
          updateInputField(3, transcript);
          break;
      }
      updateGuideText(currentStep);
      updateAddButtonState();
      startRecordingButton.disabled = false;
      startRecordingButton.textContent = 'ðŸŽ¤ Mulai Catat';
    };

    recognition.onerror = (event) => {
      alert('Terjadi kesalahan pengenalan suara: ' + event.error);
      startRecordingButton.disabled = false;
      startRecordingButton.textContent = 'ðŸŽ¤ Mulai Catat';
    };

    recognition.onend = () => {
      if(!startRecordingButton.disabled){
        startRecordingButton.textContent = 'ðŸŽ¤ Mulai Catat';
      }
    };
  }

  startRecordingButton.addEventListener('click', startRecognition);

  addItemButton.addEventListener('click', () => {
    const name = tempInputs[0];
    const quantity = tempInputs[1];
    const costNum = parseLocaleNumber(tempInputs[2]);
    const priceNum = parseLocaleNumber(tempInputs[3]);
    const item = {
      name,
      quantity,
      cost: costNum.toLocaleString('id-ID'),
      price: priceNum.toLocaleString('id-ID')
    };
    items.push(item);
    localStorage.setItem('items', JSON.stringify(items));
    clearAllInputs();
    renderItems();
    updateGuideText(0);
  });

  clearButtons.forEach(btn => btn.addEventListener('click', e => {
    const step = parseInt(e.currentTarget.getAttribute('data-clear'));
    clearInputField(step);
  }));

  window.addEventListener('load', () => {
    clearAllInputs();
    renderItems();
    updateGuideText(0);
  });
})();
</script>
</body>
</html>
</content>
</create_file>
