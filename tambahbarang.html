<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tambah Barang</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #003366, #005599);
      color: #fff;
      padding: 1rem;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .menu-button {
      background: white;
      color: #003366;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
    }
    .instruction {
      background: #ffffffaa;
      color: #003366;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .data-display {
      background: #ffffff33;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .data-display p {
      margin: 0.5rem 0;
      font-size: 0.95rem;
    }
    .mic-btn {
      background: #fff;
      color: #003366;
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 20px;
      display: block;
      margin: 1rem auto;
    }
    .catalog-title {
      font-size: 1.2rem;
      margin-top: 2rem;
      margin-bottom: 0.5rem;
    }
    .catalog {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .product-card {
      background: #ffffffcc;
      color: #003366;
      padding: 1rem;
      border-radius: 10px;
      position: relative;
    }
    .product-card h3 {
      margin: 0;
      font-size: 1.1rem;
    }
    .product-card small {
      display: block;
      font-size: 0.9rem;
    }
    .hapus-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: crimson;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 2px 8px;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>

  <header>
    <button class="menu-button" onclick="location.href='home.html'">Menu</button>
    Tambah Barang
  </header>

  <div class="instruction" id="perintah">üé§ Ucapkan: "Nama barang [nama]"</div>

  <div class="data-display">
    <p>üìù Nama Barang: <span id="namaBarang">-</span></p>
    <p>üì¶ Jumlah: <span id="jumlahBarang">-</span></p>
    <p>üí∞ Modal: <span id="modalBarang">-</span></p>
    <p>üè∑Ô∏è Jual: <span id="jualBarang">-</span></p>
  </div>

  <button class="mic-btn" onclick="mulaiRekam()">üéôÔ∏è Mulai Ngomong</button>

  <div class="catalog-title">Daftar Barang</div>
  <div id="katalog" class="catalog"></div>

  <script>
    let step = 0;
    const formData = { nama: "", jumlah: "", modal: "", jual: "" };

    function updatePerintah() {
      const p = document.getElementById("perintah");
      switch (step) {
        case 0: p.innerText = 'üé§ Ucapkan: "Nama barang [nama]"'; break;
        case 1: p.innerText = 'üé§ Ucapkan: "Jumlah [angka]"'; break;
        case 2: p.innerText = 'üé§ Ucapkan: "Modal [angka]"'; break;
        case 3: p.innerText = 'üé§ Ucapkan: "Jual [angka]"'; break;
        default: p.innerText = '‚úÖ Semua data terisi. Ucapkan "hapus" untuk reset.'; break;
      }
    }

    function lanjutStep() {
      step++;
      updatePerintah();
    }

    function mulaiRekam() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'id-ID';
      recognition.start();

      recognition.onresult = function(event) {
        const text = event.results[0][0].transcript.toLowerCase();
        prosesInput(text);
      };

      recognition.onerror = function() {
        alert('üé§ Tidak bisa mengakses suara. Coba ulangi.');
      };
    }

    function prosesInput(input) {
      if (input.includes("hapus")) {
        resetForm();
        return;
      }

      if (step === 0 && input.includes("nama")) {
        const nama = input.replace("nama barang", "").trim();
        if (nama) {
          formData.nama = nama;
          document.getElementById("namaBarang").innerText = nama;
          lanjutStep();
        }
      } else if (step === 1 && input.includes("jumlah")) {
        const jumlah = input.replace("jumlah", "").trim();
        if (jumlah) {
          formData.jumlah = jumlah;
          document.getElementById("jumlahBarang").innerText = jumlah;
          lanjutStep();
        }
      } else if (step === 2 && input.includes("modal")) {
        const modal = input.replace("modal", "").trim();
        if (modal) {
          formData.modal = modal;
          document.getElementById("modalBarang").innerText = modal;
          lanjutStep();
        }
      } else if (step === 3 && input.includes("jual")) {
        const jual = input.replace("jual", "").trim();
        if (jual) {
          formData.jual = jual;
          document.getElementById("jualBarang").innerText = jual;
          simpanData();
          resetForm();
        }
      }
    }

    function simpanData() {
      const list = JSON.parse(localStorage.getItem("produk") || "[]");
      list.push({...formData});
      localStorage.setItem("produk", JSON.stringify(list));
      tampilkanKatalog();
    }

    function resetForm() {
      step = 0;
      formData.nama = "";
      formData.jumlah = "";
      formData.modal = "";
      formData.jual = "";
      document.getElementById("namaBarang").innerText = "-";
      document.getElementById("jumlahBarang").innerText = "-";
      document.getElementById("modalBarang").innerText = "-";
      document.getElementById("jualBarang").innerText = "-";
      updatePerintah();
    }

    function tampilkanKatalog() {
      const katalog = document.getElementById("katalog");
      katalog.innerHTML = "";
      const data = JSON.parse(localStorage.getItem("produk") || "[]");

      data.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "product-card";
        div.innerHTML = `
          <button class="hapus-btn" onclick="hapusItem(${i})">Hapus</button>
          <h3>${item.nama}</h3>
          <small>Jumlah: ${item.jumlah}</small>
          <small>Modal: Rp${item.modal}</small>
          <small>Jual: Rp${item.jual}</small>
        `;
        katalog.appendChild(div);
      });
    }

    function hapusItem(index) {
      const data = JSON.parse(localStorage.getItem("produk") || "[]");
      data.splice(index, 1);
      localStorage.setItem("produk", JSON.stringify(data));
      tampilkanKatalog();
    }

    window.onload = () => {
      updatePerintah();
      tampilkanKatalog();
    };
  </script>
</body>
</html>
